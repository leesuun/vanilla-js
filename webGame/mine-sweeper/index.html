<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"
        />
        <title>ÏßÄÎ¢∞Ï∞æÍ∏∞</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            header {
                text-align: center;
                margin-bottom: 3rem;
            }
            .level__box {
                margin: 0 auto;
                text-align: center;
            }

            table {
                /* border-collapse: collapse; */
                border-spacing: 0;
                margin: 0 auto;
            }

            td {
                background-color: green;
                margin: 0;
                width: 35px;
                height: 35px;
                border: 1px solid white;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div class="wraaper">
            <header>
                <h1>ÏßÄÎ¢∞Ï∞æÍ∏∞</h1>
            </header>
            <main>
                <div id="level" class="level__box">
                    <button class="btn btn-info">Ïâ¨ÏõÄ</button>
                    <button class="btn btn-info">Î≥¥ÌÜµ</button>
                    <button class="btn btn-info">Ïñ¥Î†§ÏõÄ</button>
                </div>

                <table id="mineTable" oncontextmenu="return false">
                    <tbody></tbody>
                </table>
            </main>
        </div>

        <script>
            const levelBox = document.querySelector("#level");
            const levelBtn = document.querySelectorAll("#level button");

            const table = document.querySelector("#mineTable");
            const tbody = table.querySelector("tbody");
            table.addEventListener("contextmenu", (event) =>
                event.preventDefault()
            ); // Ïö∞ÌÅ¥Î¶≠ ÌåùÏóÖ Ïù¥Î≤§Ìä∏ Î∞©ÏßÄ
            let tds;

            const LEVEL = {
                easy: {
                    col: 10,
                    row: 8,
                    mine: 10,
                },
                normal: {
                    col: 18,
                    row: 14,
                    mine: 40,
                },
                hard: {
                    col: 26,
                    row: 18,
                    mine: 100,
                },
            };
            const LEFT_CLICK = 1;
            const MIDDLE_CLICK = 2;
            const RIGHT_CLICK = 3;

            let tableCells = [];

            // ÏßÄÎ¢∞Ï∞æÍ∏∞ ÌÖåÏù¥Î∏î ÏÉùÏÑ±
            function createTableCells(level) {
                for (let i = 0; i < level.row; i++) {
                    const tr = document.createElement("tr");
                    let cells = [];
                    for (let j = 0; j < level.col; j++) {
                        const td = document.createElement("td");
                        cells.push(td);
                        tr.appendChild(td);
                    }
                    tbody.appendChild(tr);
                    tableCells.push(cells);
                }
                createMine(tbody, level.mine);
            }

            // ÎûúÎç§ ÏúÑÏπòÏóê ÏßÄÎ¢∞ ÏÉùÏÑ±
            function createMine(tbody, mineNum) {
                tds = tbody.querySelectorAll("td");
                let randomIdx = [];

                while (true) {
                    randomIdx.push(Math.floor(Math.random() * tds.length));
                    randomIdx = [...new Set(randomIdx)];
                    if (randomIdx.length === mineNum) {
                        for (let i = 0; i < randomIdx.length; i++) {
                            const span = document.createElement("span");
                            span.textContent = "üí•";
                            span.hidden = true;
                            tds[randomIdx[i]].appendChild(span);
                        }
                        break;
                    }
                }

                // console.log(tableCells);

                // üö©‚ùó‚ö†üí•
            }
            let mineCnt = 0;
            function handleCellClick(event) {
                event.preventDefault();
                const mines = table.querySelectorAll("span"); // Ìè≠ÌÉÑ
                const {
                    which,
                    target,
                    target: { childElementCount },
                } = event;

                switch (which) {
                    case LEFT_CLICK:
                        console.log("ÎßàÏö∞Ïä§ Ï¢å ÌÅ¥Î¶≠");
                        const rowIdx = target.parentNode.rowIndex;
                        const cellIdx = target.cellIndex;

                        if (
                            target.textContent === "‚ùó" ||
                            target.textContent === "üö©"
                        ) {
                            // ÎäêÎÇåÌëú or ÍπÉÎ∞úÏù¥ ÏûàÎäîÏßÄ
                            return;
                        }

                        if (childElementCount) {
                            // ÏßÄÎ¢∞ ÌÅ¥Î¶≠
                            mines.forEach((mine) => (mine.hidden = false));
                            setTimeout(() => {
                                alert("Ìå®Î∞∞");
                            }, 500);

                            return;
                        }

                        if (false) {
                            //ÎÑ§
                            //ÏäπÎ¶¨ ÌëúÏãú
                            return;
                        }
                        // Ïó¥ Ïàò ÏûàÎäî Ïπ∏ Í∞úÎ∞©
                        mineCnt = 0;

                        if (!childElementCount) {
                            console.log("r:", rowIdx, "c:", cellIdx);

                            for (let i = -1; i <= 1; i++) {
                                if (
                                    rowIdx + i === -1 ||
                                    rowIdx + i === tableCells.length
                                ) {
                                    continue;
                                }

                                for (let j = -1; j <= 1; j++) {
                                    if (
                                        cellIdx + j === -1 ||
                                        cellIdx + j === tableCells[0].length
                                    ) {
                                        continue;
                                    }

                                    mineCnt +=
                                        tableCells[rowIdx + i][cellIdx + j]
                                            .childElementCount;
                                }
                            }

                            if (mineCnt !== 0) {
                                target.textContent = mineCnt;
                                target.style.background = "gray";
                                return;
                            }
                            target.style.background = "gray";

                            //Ï†ÑÏù¥ ÏãúÏºú
                            console.log(mineCnt);
                        }

                        break;
                    case MIDDLE_CLICK:
                        console.log("ÎßàÏö∞Ïä§ Í∞ÄÏö¥Îç∞ ÌÅ¥Î¶≠");
                        break;
                    case RIGHT_CLICK:
                        console.log("ÎßàÏö∞Ïä§ Ïö∞ ÌÅ¥Î¶≠");
                        console.log(target);
                        if (target.textContent === "") {
                            target.textContent = "‚ùì";
                            target.removeEventListener(
                                "mousedown",
                                handleCellClick
                            );
                            return;
                        }
                        if (target.textContent === "‚ùì") {
                            target.textContent = "üö©";

                            return;
                        }
                        if ((target.textContent = "üö©")) {
                            target.textContent = "";
                            target.addEventListener(
                                "mousedown",
                                handleCellClick
                            );
                            return;
                        }

                        break;

                    default:
                        break;
                }
            }

            function handleSelectLevel() {
                const { textContent } = this;
                levelBox.hidden = true;

                switch (textContent) {
                    case "Ïâ¨ÏõÄ":
                        //   Ï¥àÍ∏â Í∞ÄÎ°ú8 , ÏÑ∏Î°ú 10, ÏßÄÎ¢∞ 10Í∞ú

                        createTableCells(LEVEL.easy);
                        break;
                    case "Î≥¥ÌÜµ":
                        //   Ï§ëÍ∏â Í∞ÄÎ°ú14 , ÏÑ∏Î°ú 18, ÏßÄÎ¢∞ 40Í∞ú
                        console.log(textContent);
                        createTableCells(LEVEL.normal);
                        break;
                    case "Ïñ¥Î†§ÏõÄ":
                        //  ÏÉÅÍ∏â Í∞ÄÎ°ú18 , ÏÑ∏Î°ú 26, ÏßÄÎ¢∞ 100Í∞ú
                        console.log(textContent);
                        createTableCells(LEVEL.hard);
                        break;
                    default:
                        break;
                }
            }

            table.addEventListener("mousedown", handleCellClick);
            levelBtn.forEach((button) => {
                button.addEventListener("click", handleSelectLevel);
            });
        </script>
    </body>
</html>

<!-- [i-1][j-1] ÏßÄÎ¢∞[i-1][j] [i-1][j+1] // [i][j-1] ÏßÄÎ¢∞[i][j] [i][j+1] // -->
<!-- [i+1][j-1] ÏßÄÎ¢∞[i+1][j] [i+1][j+1] -->
