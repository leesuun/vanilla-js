<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"
        />
        <title>ÏßÄÎ¢∞Ï∞æÍ∏∞</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            header {
                text-align: center;
                margin-bottom: 3rem;
            }
            .level__box {
                margin: 0 auto;
                text-align: center;
            }

            table {
                /* border-collapse: collapse; */
                border-spacing: 0;
                margin: 0 auto;
            }

            td {
                background-color: green;
                margin: 0;
                width: 35px;
                height: 35px;
                border: 1px solid white;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div class="wraaper">
            <header>
                <h1>ÏßÄÎ¢∞Ï∞æÍ∏∞</h1>
            </header>
            <main>
                <div id="level" class="level__box">
                    <button class="btn btn-info">Ïâ¨ÏõÄ</button>
                    <button class="btn btn-info">Î≥¥ÌÜµ</button>
                    <button class="btn btn-info">Ïñ¥Î†§ÏõÄ</button>
                </div>

                <table id="mineTable" oncontextmenu="return false">
                    <tbody></tbody>
                </table>
            </main>
        </div>

        <script>
            const levelBox = document.querySelector("#level");
            const levelBtn = document.querySelectorAll("#level button");

            const table = document.querySelector("#mineTable");
            const tbody = table.querySelector("tbody");
            table.addEventListener("contextmenu", (event) =>
                event.preventDefault()
            ); // Ïö∞ÌÅ¥Î¶≠ ÌåùÏóÖ Ïù¥Î≤§Ìä∏ Î∞©ÏßÄ

            const LEVEL = {
                easy: {
                    col: 10,
                    row: 8,
                    mine: 10,
                },
                normal: {
                    col: 18,
                    row: 14,
                    mine: 40,
                },
                hard: {
                    col: 26,
                    row: 18,
                    mine: 100,
                },
            };
            const LEFT_CLICK = 1;
            const MIDDLE_CLICK = 2;
            const RIGHT_CLICK = 3;

            let tableCellAry = [];

            // ÏßÄÎ¢∞Ï∞æÍ∏∞ ÌÖåÏù¥Î∏î ÏÉùÏÑ±
            function createTableCells(level) {
                for (let i = 0; i < level.row; i++) {
                    const tr = document.createElement("tr");
                    let cells = [];
                    for (let j = 0; j < level.col; j++) {
                        const td = document.createElement("td");
                        cells.push(td);
                        tr.appendChild(td);
                    }
                    tbody.appendChild(tr);
                    tableCellAry.push(cells);
                }
                createMine(tbody, level.mine);
            }

            // ÎûúÎç§ ÏúÑÏπòÏóê ÏßÄÎ¢∞ ÏÉùÏÑ±
            function createMine(tbody, mineNum) {
                const tds = tbody.querySelectorAll("td");
                let randomIdx = [];

                while (true) {
                    randomIdx.push(Math.floor(Math.random() * tds.length));
                    randomIdx = [...new Set(randomIdx)];
                    if (randomIdx.length === mineNum) {
                        for (let i = 0; i < randomIdx.length; i++) {
                            const span = document.createElement("span");
                            span.textContent = "üí•";
                            // span.hidden = true;
                            tds[randomIdx[i]].appendChild(span);
                        }
                        break;
                    }
                }
                // console.log(tbody);
                console.log(tableCellAry);

                const mines = table.querySelectorAll("span"); // Ìè≠ÌÉÑ
                // console.log(mines);
                // setTimeout(() => {
                //     mines.forEach((mine) => (mine.hidden = false));
                // }, 1000);
                // üö©‚ùó‚ö†üí•
            }

            function handleCellClick(event) {
                event.preventDefault();
                const {
                    which,
                    target,
                    target: { childElementCount },
                } = event;

                switch (which) {
                    case LEFT_CLICK:
                        console.log("ÎßàÏö∞Ïä§ Ï¢å ÌÅ¥Î¶≠");

                        if (
                            target.textContent === "‚ùó" ||
                            target.textContent === "üö©"
                        ) {
                            // ÎäêÎÇåÌëú or ÍπÉÎ∞úÏù¥ ÏûàÎäîÏßÄ
                            return;
                        }

                        if (childElementCount) {
                            // ÏßÄÎ¢∞ ÌÅ¥Î¶≠
                            // ÏßÄÎ¢∞ ÏúÑÏπò ÌëúÏãúÌïòÍ∏∞
                            return;
                        }
                        // Ïπ∏ Ï†ïÎ≥¥ Ïò§Ìîà
                        //Î™®Îì† Ïπ∏ÏùÑ Ïó¥ÏóàÎÇò?
                        if (true) {
                            //ÎÑ§
                            //ÏäπÎ¶¨ ÌëúÏãú
                            return;
                        }
                        // Ïó¥ Ïàò ÏûàÎäî Ïπ∏ Í∞úÎ∞©

                        break;
                    case MIDDLE_CLICK:
                        console.log("ÎßàÏö∞Ïä§ Í∞ÄÏö¥Îç∞ ÌÅ¥Î¶≠");
                        break;
                    case RIGHT_CLICK:
                        console.log("ÎßàÏö∞Ïä§ Ïö∞ ÌÅ¥Î¶≠");
                        break;

                    default:
                        break;
                }
            }

            function handleSelectLevel() {
                const { textContent } = this;
                levelBox.hidden = true;

                switch (textContent) {
                    case "Ïâ¨ÏõÄ":
                        //   Ï¥àÍ∏â Í∞ÄÎ°ú8 , ÏÑ∏Î°ú 10, ÏßÄÎ¢∞ 10Í∞ú
                        console.log(textContent);
                        createTableCells(LEVEL.easy);
                        break;
                    case "Î≥¥ÌÜµ":
                        //   Ï§ëÍ∏â Í∞ÄÎ°ú14 , ÏÑ∏Î°ú 18, ÏßÄÎ¢∞ 40Í∞ú
                        console.log(textContent);
                        createTableCells(LEVEL.normal);
                        break;
                    case "Ïñ¥Î†§ÏõÄ":
                        //  ÏÉÅÍ∏â Í∞ÄÎ°ú18 , ÏÑ∏Î°ú 26, ÏßÄÎ¢∞ 100Í∞ú
                        console.log(textContent);
                        createTableCells(LEVEL.hard);
                        break;
                    default:
                        break;
                }
            }

            table.addEventListener("mousedown", handleCellClick);
            levelBtn.forEach((button) => {
                button.addEventListener("click", handleSelectLevel);
            });
        </script>
    </body>
</html>
